
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Testing &#8212; The LLDB Debugger</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/lldb.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Continuous Integration" href="bots.html" />
    <link rel="prev" title="Build" href="build.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="testing">
<h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<p>The LLDB test suite consists of Python scripts located under the test
directory. Each script contains a number of test cases and is usually
accompanied by a C (C++, ObjC, etc.) source file. Each test first compiles the
source file and then uses LLDB to debug the resulting executable. The tests
verify both the LLDB command line interface and the scripting API.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#running-the-full-test-suite" id="id1">Running the Full Test Suite</a></p></li>
<li><p><a class="reference internal" href="#running-a-specific-test-or-set-of-tests" id="id2">Running a Specific Test or Set of Tests</a></p></li>
<li><p><a class="reference internal" href="#running-the-test-suite-remotely" id="id3">Running the Test Suite Remotely</a></p></li>
<li><p><a class="reference internal" href="#debugging-test-failures" id="id4">Debugging Test Failures</a></p></li>
<li><p><a class="reference internal" href="#debugging-test-failures-on-windows" id="id5">Debugging Test Failures on Windows</a></p></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On Windows any invocations of python should be replaced with python_d, the
debug interpreter, when running the test suite against a debug version of
LLDB.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On NetBSD you must export <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH=$PWD/lib</span></code> in your environment.
This is due to lack of the <code class="docutils literal notranslate"><span class="pre">$ORIGIN</span></code> linker feature.</p>
</div>
<div class="section" id="running-the-full-test-suite">
<h2><a class="toc-backref" href="#id1">Running the Full Test Suite</a><a class="headerlink" href="#running-the-full-test-suite" title="Permalink to this headline">¶</a></h2>
<p>The easiest way to run the LLDB test suite is to use the <code class="docutils literal notranslate"><span class="pre">check-lldb</span></code> build
target.</p>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">check-lldb</span></code> target builds the test programs with the same
compiler that was used to build LLDB. To build the tests with a different
compiler, you can set the <code class="docutils literal notranslate"><span class="pre">LLDB_TEST_C_COMPILER</span></code> or the
<code class="docutils literal notranslate"><span class="pre">LLDB_TEST_CXX_COMPILER</span></code> CMake variables. These variables are ignored unless
the respective <code class="docutils literal notranslate"><span class="pre">LLDB_TEST_USE_CUSTOM_C_COMPILER</span></code> and
<code class="docutils literal notranslate"><span class="pre">LLDB_TEST_USE_CUSTOM_CXX_COMPILER</span></code> are set to <code class="docutils literal notranslate"><span class="pre">ON</span></code>.</p>
<p>It is possible to customize the architecture of the test binaries and compiler
used by appending <code class="docutils literal notranslate"><span class="pre">-A</span></code> and <code class="docutils literal notranslate"><span class="pre">-C</span></code> options respectively to the CMake variable
<code class="docutils literal notranslate"><span class="pre">LLDB_TEST_USER_ARGS</span></code>. For example, to test LLDB against 32-bit binaries
built with a custom version of clang, do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">cmake</span> <span class="o">-</span><span class="n">DLLDB_TEST_USER_ARGS</span><span class="o">=</span><span class="s2">&quot;-A i386 -C /path/to/custom/clang&quot;</span> <span class="o">-</span><span class="n">G</span> <span class="n">Ninja</span>
<span class="o">&gt;</span> <span class="n">ninja</span> <span class="n">check</span><span class="o">-</span><span class="n">lldb</span>
</pre></div>
</div>
<p>Note that multiple <code class="docutils literal notranslate"><span class="pre">-A</span></code> and <code class="docutils literal notranslate"><span class="pre">-C</span></code> flags can be specified to
<code class="docutils literal notranslate"><span class="pre">LLDB_TEST_USER_ARGS</span></code>.</p>
</div>
<div class="section" id="running-a-specific-test-or-set-of-tests">
<h2><a class="toc-backref" href="#id2">Running a Specific Test or Set of Tests</a><a class="headerlink" href="#running-a-specific-test-or-set-of-tests" title="Permalink to this headline">¶</a></h2>
<p>In addition to running all the LLDB test suites with the <code class="docutils literal notranslate"><span class="pre">check-lldb</span></code> CMake
target above, it is possible to run individual LLDB tests. If you have a CMake
build you can use the <code class="docutils literal notranslate"><span class="pre">lldb-dotest</span></code> binary, which is a wrapper around
<code class="docutils literal notranslate"><span class="pre">dotest.py</span></code> that passes all the arguments configured by CMake. Alternatively,
you can use <code class="docutils literal notranslate"><span class="pre">dotest.py</span></code> directly, if you want to run a test one-off with a
different configuration.</p>
<p>For example, to run the test cases defined in TestInferiorCrashing.py, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">lldb</span><span class="o">-</span><span class="n">dotest</span> <span class="o">-</span><span class="n">p</span> <span class="n">TestInferiorCrashing</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt; cd $lldb/test
&gt; python dotest.py --executable &lt;path-to-lldb&gt; -p TestInferiorCrashing.py ../packages/Python/lldbsuite/test
</pre></div>
</div>
<p>If the test is not specified by name (e.g. if you leave the <code class="docutils literal notranslate"><span class="pre">-p</span></code> argument
off),  all tests in that directory will be executed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">lldb</span><span class="o">-</span><span class="n">dotest</span> <span class="n">functionalities</span><span class="o">/</span><span class="n">data</span><span class="o">-</span><span class="n">formatter</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">python</span> <span class="n">dotest</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">executable</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">lldb</span><span class="o">&gt;</span> <span class="n">functionalities</span><span class="o">/</span><span class="n">data</span><span class="o">-</span><span class="n">formatter</span>
</pre></div>
</div>
<p>Many more options that are available. To see a list of all of them, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">python</span> <span class="n">dotest</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">dotest.py</span></code> script runs tests in parallel by default. To disable the
parallel test running feature, use the <code class="docutils literal notranslate"><span class="pre">--no-multiprocess</span></code> flag. The number
of concurrent tests is controlled by the <code class="docutils literal notranslate"><span class="pre">LLDB_TEST_THREADS</span></code> environment
variable or the <code class="docutils literal notranslate"><span class="pre">--threads</span> <span class="pre">command</span></code> line parameter. The default value is the
number of CPU cores on your system.</p>
<p>The parallel test running feature will handle an additional <code class="docutils literal notranslate"><span class="pre">--test-subdir</span>
<span class="pre">SUBDIR</span></code> arg. When specified, <code class="docutils literal notranslate"><span class="pre">SUBDIR</span></code> is relative to the root test directory
and will limit all parallel test running to that subdirectory’s tree of tests.</p>
<p>The parallel test runner will run all tests within a given directory serially,
but will run multiple directories concurrently. Thus, as a test writer, we
provide serialized test run semantics within a directory. Note child
directories are considered entirely separate, so two child directories could be
running in parallel with a parent directory.</p>
</div>
<div class="section" id="running-the-test-suite-remotely">
<h2><a class="toc-backref" href="#id3">Running the Test Suite Remotely</a><a class="headerlink" href="#running-the-test-suite-remotely" title="Permalink to this headline">¶</a></h2>
<p>Running the test-suite remotely is similar to the process of running a local
test suite, but there are two things to have in mind:</p>
<ol class="arabic simple">
<li><p>You must have the lldb-server running on the remote system, ready to accept
multiple connections. For more information on how to setup remote debugging
see the Remote debugging page.</p></li>
<li><p>You must tell the test-suite how to connect to the remote system. This is
achieved using the <code class="docutils literal notranslate"><span class="pre">--platform-name</span></code>, <code class="docutils literal notranslate"><span class="pre">--platform-url</span></code> and
<code class="docutils literal notranslate"><span class="pre">--platform-working-dir</span></code> parameters to <code class="docutils literal notranslate"><span class="pre">dotest.py</span></code>. These parameters
correspond to the platform select and platform connect LLDB commands. You
will usually also need to specify the compiler and architecture for the
remote system.</p></li>
</ol>
<p>Currently, running the remote test suite is supported only with <code class="docutils literal notranslate"><span class="pre">dotest.py</span></code> (or
dosep.py with a single thread), but we expect this issue to be addressed in the
near future.</p>
</div>
<div class="section" id="debugging-test-failures">
<h2><a class="toc-backref" href="#id4">Debugging Test Failures</a><a class="headerlink" href="#debugging-test-failures" title="Permalink to this headline">¶</a></h2>
<p>On non-Windows platforms, you can use the <code class="docutils literal notranslate"><span class="pre">-d</span></code> option to <code class="docutils literal notranslate"><span class="pre">dotest.py</span></code> which
will cause the script to wait for a while until a debugger is attached.</p>
</div>
<div class="section" id="debugging-test-failures-on-windows">
<h2><a class="toc-backref" href="#id5">Debugging Test Failures on Windows</a><a class="headerlink" href="#debugging-test-failures-on-windows" title="Permalink to this headline">¶</a></h2>
<p>On Windows, it is strongly recommended to use Python Tools for Visual Studio
for debugging test failures. It can seamlessly step between native and managed
code, which is very helpful when you need to step through the test itself, and
then into the LLDB code that backs the operations the test is performing.</p>
<p>A quick guide to getting started with PTVS is as follows:</p>
<ol class="arabic simple">
<li><p>Install PTVS</p></li>
<li><dl class="simple">
<dt>Create a Visual Studio Project for the Python code.</dt><dd><ol class="arabic simple">
<li><p>Go to File -&gt; New -&gt; Project -&gt; Python -&gt; From Existing Python Code.</p></li>
<li><p>Choose llvm/tools/lldb as the directory containing the Python code.</p></li>
<li><p>When asked where to save the .pyproj file, choose the folder <code class="docutils literal notranslate"><span class="pre">llvm/tools/lldb/pyproj</span></code>. This is a special folder that is ignored by the <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file, since it is not checked in.</p></li>
</ol>
</dd>
</dl>
</li>
<li><p>Set test/dotest.py as the startup file</p></li>
<li><dl class="simple">
<dt>Make sure there is a Python Environment installed for your distribution. For example, if you installed Python to <code class="docutils literal notranslate"><span class="pre">C:\Python35</span></code>, PTVS needs to know that this is the interpreter you want to use for running the test suite.</dt><dd><ol class="arabic simple">
<li><p>Go to Tools -&gt; Options -&gt; Python Tools -&gt; Environment Options</p></li>
<li><p>Click Add Environment, and enter Python 3.5 Debug for the name. Fill out the values correctly.</p></li>
</ol>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Configure the project to use this debug interpreter.</dt><dd><ol class="arabic simple">
<li><p>Right click the Project node in Solution Explorer.</p></li>
<li><p>In the General tab, Make sure Python 3.5 Debug is the selected Interpreter.</p></li>
<li><p>In Debug/Search Paths, enter the path to your ninja/lib/site-packages directory.</p></li>
<li><p>In Debug/Environment Variables, enter <code class="docutils literal notranslate"><span class="pre">VCINSTALLDIR=C:\Program</span> <span class="pre">Files</span> <span class="pre">(x86)\Microsoft</span> <span class="pre">Visual</span> <span class="pre">Studio</span> <span class="pre">14.0\VC\</span></code>.</p></li>
<li><p>If you want to enabled mixed mode debugging, check Enable native code debugging (this slows down debugging, so enable it only on an as-needed basis.)</p></li>
</ol>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Set the command line for the test suite to run.</dt><dd><ol class="arabic simple">
<li><p>Right click the project in solution explorer and choose the Debug tab.</p></li>
<li><p>Enter the arguments to dotest.py. Note you must add –no-multiprocess</p></li>
<li><p>Example command options:</p></li>
</ol>
</dd>
</dl>
</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># quiet mode</span>
<span class="o">-</span><span class="n">q</span>
<span class="o">--</span><span class="n">arch</span><span class="o">=</span><span class="n">i686</span>
<span class="c1"># Path to debug lldb.exe</span>
<span class="o">--</span><span class="n">executable</span> <span class="n">D</span><span class="p">:</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvmbuild</span><span class="o">/</span><span class="n">ninja</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">lldb</span><span class="o">.</span><span class="n">exe</span>
<span class="c1"># Directory to store log files</span>
<span class="o">-</span><span class="n">s</span> <span class="n">D</span><span class="p">:</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvmbuild</span><span class="o">/</span><span class="n">ninja</span><span class="o">/</span><span class="n">lldb</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">traces</span>
<span class="o">-</span><span class="n">u</span> <span class="n">CXXFLAGS</span> <span class="o">-</span><span class="n">u</span> <span class="n">CFLAGS</span>
<span class="c1"># If a test crashes, show JIT debugging dialog.</span>
<span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">crash</span><span class="o">-</span><span class="n">dialog</span>
<span class="c1"># Path to release clang.exe</span>
<span class="o">-</span><span class="n">C</span> <span class="n">d</span><span class="p">:</span>\<span class="n">src</span>\<span class="n">llvmbuild</span>\<span class="n">ninja_release</span>\<span class="nb">bin</span>\<span class="n">clang</span><span class="o">.</span><span class="n">exe</span>
<span class="c1"># Path to the particular test you want to debug.</span>
<span class="o">-</span><span class="n">p</span> <span class="n">TestPaths</span><span class="o">.</span><span class="n">py</span>
<span class="c1"># Root of test tree</span>
<span class="n">D</span><span class="p">:</span>\<span class="n">src</span>\<span class="n">llvm</span>\<span class="n">tools</span>\<span class="n">lldb</span>\<span class="n">packages</span>\<span class="n">Python</span>\<span class="n">lldbsuite</span>\<span class="n">test</span>
<span class="c1"># Required in order to be able to debug the test.</span>
<span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">multiprocess</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">q</span> <span class="o">--</span><span class="n">arch</span><span class="o">=</span><span class="n">i686</span> <span class="o">--</span><span class="n">executable</span> <span class="n">D</span><span class="p">:</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvmbuild</span><span class="o">/</span><span class="n">ninja</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">lldb</span><span class="o">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">s</span> <span class="n">D</span><span class="p">:</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">llvmbuild</span><span class="o">/</span><span class="n">ninja</span><span class="o">/</span><span class="n">lldb</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">traces</span> <span class="o">-</span><span class="n">u</span> <span class="n">CXXFLAGS</span> <span class="o">-</span><span class="n">u</span> <span class="n">CFLAGS</span> <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">crash</span><span class="o">-</span><span class="n">dialog</span> <span class="o">-</span><span class="n">C</span> <span class="n">d</span><span class="p">:</span>\<span class="n">src</span>\<span class="n">llvmbuild</span>\<span class="n">ninja_release</span>\<span class="nb">bin</span>\<span class="n">clang</span><span class="o">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">p</span> <span class="n">TestPaths</span><span class="o">.</span><span class="n">py</span> <span class="n">D</span><span class="p">:</span>\<span class="n">src</span>\<span class="n">llvm</span>\<span class="n">tools</span>\<span class="n">lldb</span>\<span class="n">packages</span>\<span class="n">Python</span>\<span class="n">lldbsuite</span>\<span class="n">test</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">multiprocess</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">LLDB</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Goals &amp; Status</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../status/goals.html">Goals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../status/features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../status/status.html">Status</a></li>
<li class="toctree-l1"><a class="reference internal" href="../status/projects.html">Projects</a></li>
</ul>
<p class="caption"><span class="caption-text">Use &amp; Extension</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../use/tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use/map.html">GDB to LLDB command map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use/formatting.html">Frame and Thread Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use/variable.html">Variable Formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use/symbolication.html">Symbolication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use/symbols.html">Symbols on macOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use/python.html">Python Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use/python-reference.html">Python Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use/remote.html">Remote Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use/architecture.html">Architecture</a></li>
</ul>
<p class="caption"><span class="caption-text">Resources</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="download.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="source.html">Getting the Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Build</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="bots.html">Continuous Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="sbapi.html">The SB API Coding Rules</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://lldb.llvm.org/python_reference/index.html">Public Python API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://lldb.llvm.org/cpp_reference/namespacelldb.html">Public C++ API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://lldb.llvm.org/cpp_reference/index.html">Private C++ Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">External Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="http://llvm.org/viewvc/llvm-project/lldb/trunk/">Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://reviews.llvm.org">Code Reviews</a></li>
<li class="toctree-l1"><a class="reference external" href="https://bugs.llvm.org/">Bug Reports</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="build.html" title="previous chapter">Build</a></li>
      <li>Next: <a href="bots.html" title="next chapter">Continuous Integration</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2007-2019, The LLDB Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>